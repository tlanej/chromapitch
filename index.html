<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chromesthesia Trainer</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { box-sizing: border-box; }
    body { margin: 0; background: #030712; }
    .text-shadow { text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
    @keyframes pulse-glow {
      0%, 100% { opacity: 0.8; transform: translate(-50%, -50%) scale(1); }
      50% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
    }
    .animate-pulse-glow { animation: pulse-glow 1s ease-in-out infinite; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;

    // Color mapping systems for chromesthesia
    const COLOR_SYSTEMS = {
      scriabin: {
        name: "Scriabin (Circle of Fifths)",
        colors: {
          'C': { hex: '#FF0000', name: 'Red' },
          'C#': { hex: '#8B00FF', name: 'Violet' },
          'D': { hex: '#FFFF00', name: 'Yellow' },
          'D#': { hex: '#4169E1', name: 'Steel Blue' },
          'E': { hex: '#87CEEB', name: 'Sky Blue' },
          'F': { hex: '#8B0000', name: 'Dark Red' },
          'F#': { hex: '#0000FF', name: 'Blue' },
          'G': { hex: '#FFA500', name: 'Orange' },
          'G#': { hex: '#9400D3', name: 'Purple' },
          'A': { hex: '#00FF00', name: 'Green' },
          'A#': { hex: '#4B0082', name: 'Indigo' },
          'B': { hex: '#00CED1', name: 'Cyan' }
        }
      },
      newton: {
        name: "Newton (Spectral)",
        colors: {
          'C': { hex: '#FF0000', name: 'Red' },
          'C#': { hex: '#FF4500', name: 'Red-Orange' },
          'D': { hex: '#FFA500', name: 'Orange' },
          'D#': { hex: '#FFD700', name: 'Gold' },
          'E': { hex: '#FFFF00', name: 'Yellow' },
          'F': { hex: '#9ACD32', name: 'Yellow-Green' },
          'G': { hex: '#00FF00', name: 'Green' },
          'G#': { hex: '#00CED1', name: 'Cyan' },
          'A': { hex: '#0000FF', name: 'Blue' },
          'A#': { hex: '#4B0082', name: 'Indigo' },
          'B': { hex: '#8B00FF', name: 'Violet' },
          'F#': { hex: '#32CD32', name: 'Lime Green' }
        }
      },
      therapeutic: {
        name: "Therapeutic (Calming)",
        colors: {
          'C': { hex: '#2E4A62', name: 'Deep Navy' },
          'C#': { hex: '#3D5A73', name: 'Steel' },
          'D': { hex: '#4A6B7C', name: 'Slate' },
          'D#': { hex: '#5B8A72', name: 'Sage' },
          'E': { hex: '#6B9B7E', name: 'Soft Green' },
          'F': { hex: '#7CAC8A', name: 'Mint' },
          'F#': { hex: '#8DBDA0', name: 'Sea Foam' },
          'G': { hex: '#A0C4B8', name: 'Aqua' },
          'G#': { hex: '#B3D4D1', name: 'Pale Teal' },
          'A': { hex: '#C6E4EA', name: 'Ice Blue' },
          'A#': { hex: '#D9EEF3', name: 'Frost' },
          'B': { hex: '#E8F4F8', name: 'Cloud' }
        }
      },
      warm: {
        name: "Warm Spectrum",
        colors: {
          'C': { hex: '#8B0000', name: 'Dark Red' },
          'C#': { hex: '#A52A2A', name: 'Brown' },
          'D': { hex: '#CD5C5C', name: 'Indian Red' },
          'D#': { hex: '#DC143C', name: 'Crimson' },
          'E': { hex: '#FF4500', name: 'Orange Red' },
          'F': { hex: '#FF6347', name: 'Tomato' },
          'F#': { hex: '#FF7F50', name: 'Coral' },
          'G': { hex: '#FFA07A', name: 'Light Salmon' },
          'G#': { hex: '#FFB347', name: 'Pastel Orange' },
          'A': { hex: '#FFD700', name: 'Gold' },
          'A#': { hex: '#FFEB3B', name: 'Bright Yellow' },
          'B': { hex: '#FFF8DC', name: 'Cornsilk' }
        }
      },
      cool: {
        name: "Cool Spectrum",
        colors: {
          'C': { hex: '#001f3f', name: 'Navy' },
          'C#': { hex: '#003366', name: 'Dark Blue' },
          'D': { hex: '#0074D9', name: 'Blue' },
          'D#': { hex: '#7FDBFF', name: 'Aqua' },
          'E': { hex: '#39CCCC', name: 'Teal' },
          'F': { hex: '#3D9970', name: 'Olive' },
          'F#': { hex: '#2ECC40', name: 'Green' },
          'G': { hex: '#01FF70', name: 'Lime' },
          'G#': { hex: '#B10DC9', name: 'Purple' },
          'A': { hex: '#F012BE', name: 'Fuchsia' },
          'A#': { hex: '#85144b', name: 'Maroon' },
          'B': { hex: '#111111', name: 'Black' }
        }
      }
    };

    const NOTES = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
    const OCTAVES = [3, 4, 5];
    const WAVEFORMS = ['sine', 'triangle', 'square', 'sawtooth'];
    const MODES = { LEARN: 'learn', NOTE_TO_COLOR: 'note_to_color', COLOR_TO_NOTE: 'color_to_note', FREE_PLAY: 'free_play' };

    // Particle component
    const Particle = ({ x, y, color, size, opacity }) => (
      <div
        className="absolute rounded-full pointer-events-none"
        style={{
          left: `${x}%`,
          top: `${y}%`,
          width: size,
          height: size,
          backgroundColor: color,
          opacity: opacity,
          boxShadow: `0 0 ${size * 2}px ${color}`,
          transform: 'translate(-50%, -50%)',
          transition: 'all 2s ease-out'
        }}
      />
    );

    // Immersive visualization
    const ImmersiveVisualization = ({ activeColor, intensity, isPlaying, particles, noteName }) => {
      const [ripples, setRipples] = useState([]);

      useEffect(() => {
        if (isPlaying && activeColor) {
          const newRipple = {
            id: Date.now(),
            x: 50 + (Math.random() - 0.5) * 20,
            y: 50 + (Math.random() - 0.5) * 20,
            color: activeColor,
            scale: 0
          };
          setRipples(prev => [...prev.slice(-5), newRipple]);
        }
      }, [isPlaying, activeColor]);

      useEffect(() => {
        const interval = setInterval(() => {
          setRipples(prev => prev.filter(r => r.scale < 3).map(r => ({ ...r, scale: r.scale + 0.03 })));
        }, 50);
        return () => clearInterval(interval);
      }, []);

      return (
        <div className="relative w-full h-full overflow-hidden rounded-2xl">
          {/* Background */}
          <div
            className="absolute inset-0"
            style={{
              background: activeColor
                ? `radial-gradient(ellipse at center, ${activeColor}50 0%, ${activeColor}20 40%, #0a0a1a 100%)`
                : 'radial-gradient(ellipse at center, #1a1a2e 0%, #0a0a1a 100%)',
              transition: 'background 0.5s ease'
            }}
          />

          {/* Grid overlay */}
          <div className="absolute inset-0 opacity-10"
            style={{
              backgroundImage: `linear-gradient(${activeColor || '#333'} 1px, transparent 1px),
                               linear-gradient(90deg, ${activeColor || '#333'} 1px, transparent 1px)`,
              backgroundSize: '50px 50px'
            }}
          />

          {/* Ripples */}
          {ripples.map(ripple => (
            <div
              key={ripple.id}
              className="absolute rounded-full pointer-events-none"
              style={{
                left: `${ripple.x}%`,
                top: `${ripple.y}%`,
                width: '150px',
                height: '150px',
                border: `3px solid ${ripple.color}`,
                transform: `translate(-50%, -50%) scale(${ripple.scale})`,
                opacity: Math.max(0, 1 - ripple.scale / 3),
                boxShadow: `0 0 30px ${ripple.color}, inset 0 0 30px ${ripple.color}30`
              }}
            />
          ))}

          {/* Particles */}
          {particles.map((particle, i) => (
            <Particle key={i} {...particle} />
          ))}

          {/* Central glow */}
          {activeColor && (
            <div
              className={`absolute left-1/2 top-1/2 rounded-full ${isPlaying ? 'animate-pulse-glow' : ''}`}
              style={{
                width: `${120 + (isPlaying ? 80 : 0)}px`,
                height: `${120 + (isPlaying ? 80 : 0)}px`,
                background: `radial-gradient(circle, ${activeColor} 0%, ${activeColor}80 30%, transparent 70%)`,
                boxShadow: `0 0 80px ${activeColor}, 0 0 150px ${activeColor}50`,
                transform: 'translate(-50%, -50%)',
                transition: 'all 0.3s ease'
              }}
            />
          )}

          {/* Note display */}
          {noteName && (
            <div
              className="absolute left-1/2 top-1/2 text-7xl font-black tracking-wider"
              style={{
                color: '#ffffff',
                textShadow: activeColor 
                  ? `0 0 40px ${activeColor}, 0 0 80px ${activeColor}, 0 0 120px ${activeColor}`
                  : '0 0 20px rgba(255,255,255,0.5)',
                transform: `translate(-50%, -50%) scale(${isPlaying ? 1.2 : 1})`,
                transition: 'all 0.2s ease',
                opacity: isPlaying ? 1 : 0.6
              }}
            >
              {noteName}
            </div>
          )}
        </div>
      );
    };

    // Piano key component
    const PianoKeyboard = ({ currentNote, currentOctave, playNote, colorSystem, showColors }) => {
      const colors = COLOR_SYSTEMS[colorSystem].colors;
      
      const whiteNotes = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];
      const blackNotes = ['C#', 'D#', null, 'F#', 'G#', 'A#'];
      
      return (
        <div className="flex justify-center py-4">
          {OCTAVES.map(octave => (
            <div key={octave} className="relative flex">
              {whiteNotes.map((note, i) => {
                const isActive = currentNote === note && currentOctave === octave;
                const color = colors[note]?.hex;
                return (
                  <button
                    key={`${note}${octave}`}
                    onClick={() => playNote(note, octave)}
                    className="relative w-14 h-40 border border-gray-600 rounded-b-lg transition-all duration-100 hover:translate-y-1"
                    style={{
                      backgroundColor: isActive && showColors ? color : '#f5f5f5',
                      boxShadow: isActive && showColors 
                        ? `0 0 30px ${color}, 0 0 60px ${color}50` 
                        : '0 4px 8px rgba(0,0,0,0.3)',
                      transform: isActive ? 'translateY(4px)' : undefined,
                      zIndex: 1
                    }}
                  >
                    <span className={`absolute bottom-2 left-1/2 -translate-x-1/2 text-sm font-bold ${
                      isActive && showColors ? 'text-white text-shadow' : 'text-gray-700'
                    }`}>
                      {note}{octave}
                    </span>
                  </button>
                );
              })}
              {/* Black keys */}
              {blackNotes.map((note, i) => {
                if (!note) return <div key={i} className="w-8" />;
                const isActive = currentNote === note && currentOctave === octave;
                const color = colors[note]?.hex;
                const leftOffset = [0, 1, 3, 4, 5][blackNotes.filter(Boolean).indexOf(note)] * 56 + 38;
                return (
                  <button
                    key={`${note}${octave}`}
                    onClick={() => playNote(note, octave)}
                    className="absolute w-9 h-24 rounded-b-lg transition-all duration-100 hover:translate-y-1"
                    style={{
                      left: leftOffset,
                      backgroundColor: isActive && showColors ? color : '#1a1a2e',
                      boxShadow: isActive && showColors 
                        ? `0 0 20px ${color}` 
                        : '0 4px 6px rgba(0,0,0,0.5)',
                      transform: isActive ? 'translateY(2px)' : undefined,
                      zIndex: 10
                    }}
                  >
                    <span className="absolute bottom-2 left-1/2 -translate-x-1/2 text-xs text-gray-400">
                      {note}
                    </span>
                  </button>
                );
              })}
            </div>
          ))}
        </div>
      );
    };

    // Main App
    function App() {
      const [colorSystem, setColorSystem] = useState('scriabin');
      const [mode, setMode] = useState(MODES.FREE_PLAY);
      const [currentNote, setCurrentNote] = useState(null);
      const [currentOctave, setCurrentOctave] = useState(4);
      const [isPlaying, setIsPlaying] = useState(false);
      const [waveform, setWaveform] = useState('sine');
      const [volume, setVolume] = useState(-12);
      const [showColors, setShowColors] = useState(true);
      const [particles, setParticles] = useState([]);
      const [audioStarted, setAudioStarted] = useState(false);

      // Training state
      const [trainingNote, setTrainingNote] = useState(null);
      const [trainingOctave, setTrainingOctave] = useState(4);
      const [userGuess, setUserGuess] = useState(null);
      const [showResult, setShowResult] = useState(false);
      const [stats, setStats] = useState({ correct: 0, total: 0, streak: 0, bestStreak: 0 });
      const [sessionHistory, setSessionHistory] = useState([]);

      const synthRef = useRef(null);
      const containerRef = useRef(null);

      // Initialize synth
      useEffect(() => {
        synthRef.current = new Tone.Synth({
          oscillator: { type: waveform },
          envelope: { attack: 0.05, decay: 0.2, sustain: 0.4, release: 0.8 }
        }).toDestination();
        synthRef.current.volume.value = volume;

        return () => {
          if (synthRef.current) synthRef.current.dispose();
        };
      }, []);

      // Update synth
      useEffect(() => {
        if (synthRef.current) {
          synthRef.current.oscillator.type = waveform;
          synthRef.current.volume.value = volume;
        }
      }, [waveform, volume]);

      // Generate particles
      useEffect(() => {
        const generateParticles = () => {
          const newParticles = [];
          const color = currentNote ? COLOR_SYSTEMS[colorSystem].colors[currentNote]?.hex : '#ffffff';
          for (let i = 0; i < 15; i++) {
            newParticles.push({
              x: Math.random() * 100,
              y: Math.random() * 100,
              color: color + '60',
              size: Math.random() * 10 + 4,
              opacity: Math.random() * 0.4 + 0.1
            });
          }
          setParticles(newParticles);
        };
        generateParticles();
        const interval = setInterval(generateParticles, 3000);
        return () => clearInterval(interval);
      }, [currentNote, colorSystem]);

      // Keyboard support
      useEffect(() => {
        const keyMap = {
          'a': 'C', 'w': 'C#', 's': 'D', 'e': 'D#', 'd': 'E', 'f': 'F',
          't': 'F#', 'g': 'G', 'y': 'G#', 'h': 'A', 'u': 'A#', 'j': 'B'
        };
        const handleKeyDown = (e) => {
          if (!audioStarted) return;
          const note = keyMap[e.key.toLowerCase()];
          if (note) playNote(note, 4);
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [audioStarted]);

      const startAudio = async () => {
        await Tone.start();
        setAudioStarted(true);
      };

      const playNote = useCallback((note, octave) => {
        if (!audioStarted || !synthRef.current) return;
        synthRef.current.triggerAttackRelease(`${note}${octave}`, '0.5');
        setCurrentNote(note);
        setCurrentOctave(octave);
        setIsPlaying(true);
        setTimeout(() => setIsPlaying(false), 400);
      }, [audioStarted]);

      const generateTrainingQuestion = useCallback(() => {
        const randomNote = NOTES[Math.floor(Math.random() * NOTES.length)];
        const randomOctave = OCTAVES[Math.floor(Math.random() * OCTAVES.length)];
        setTrainingNote(randomNote);
        setTrainingOctave(randomOctave);
        setUserGuess(null);
        setShowResult(false);
        if (mode === MODES.NOTE_TO_COLOR || mode === MODES.LEARN) {
          setTimeout(() => playNote(randomNote, randomOctave), 300);
        }
      }, [mode, playNote]);

      const handleGuess = (guess) => {
        setUserGuess(guess);
        setShowResult(true);
        const isCorrect = guess === trainingNote;
        setStats(prev => ({
          ...prev,
          total: prev.total + 1,
          correct: isCorrect ? prev.correct + 1 : prev.correct,
          streak: isCorrect ? prev.streak + 1 : 0,
          bestStreak: isCorrect ? Math.max(prev.bestStreak, prev.streak + 1) : prev.bestStreak
        }));
        setSessionHistory(prev => [...prev, { note: trainingNote, guess, correct: isCorrect }]);
        if (mode === MODES.COLOR_TO_NOTE) playNote(trainingNote, trainingOctave);
        setTimeout(generateTrainingQuestion, 1800);
      };

      const getCurrentColor = () => currentNote ? COLOR_SYSTEMS[colorSystem].colors[currentNote]?.hex : null;

      // Start screen
      if (!audioStarted) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 flex items-center justify-center p-4">
            <div className="text-center space-y-8 max-w-lg">
              <h1 className="text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-400 via-pink-400 to-cyan-400">
                Chromesthesia
              </h1>
              <h2 className="text-2xl text-gray-300">Audio-Visual Training System</h2>
              <p className="text-gray-400">
                Train your brain to associate musical notes with colors through immersive multi-sensory experiences
              </p>
              <button
                onClick={startAudio}
                className="px-16 py-6 bg-gradient-to-r from-purple-600 via-pink-600 to-cyan-600 text-white text-2xl font-bold rounded-2xl hover:from-purple-500 hover:via-pink-500 hover:to-cyan-500 transition-all transform hover:scale-105 shadow-2xl"
              >
                Begin Training
              </button>
              <p className="text-xs text-gray-600">Keyboard: A-J for white keys, W/E/T/Y/U for black keys</p>
            </div>
          </div>
        );
      }

      return (
        <div ref={containerRef} className="min-h-screen bg-gray-950 text-white">
          {/* Header */}
          <div className="bg-gray-900/90 backdrop-blur border-b border-gray-800 p-3 sticky top-0 z-50">
            <div className="max-w-7xl mx-auto flex flex-wrap items-center justify-between gap-3">
              <h1 className="text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400">
                Chromesthesia Trainer
              </h1>
              <div className="flex flex-wrap items-center gap-2">
                <select value={mode} onChange={(e) => { setMode(e.target.value); if (e.target.value !== MODES.FREE_PLAY) generateTrainingQuestion(); }}
                  className="bg-gray-800 border border-gray-700 rounded-lg px-3 py-1.5 text-sm">
                  <option value={MODES.FREE_PLAY}>Free Play</option>
                  <option value={MODES.LEARN}>Learn Mode</option>
                  <option value={MODES.NOTE_TO_COLOR}>Note ‚Üí Color</option>
                  <option value={MODES.COLOR_TO_NOTE}>Color ‚Üí Note</option>
                </select>
                <select value={colorSystem} onChange={(e) => setColorSystem(e.target.value)}
                  className="bg-gray-800 border border-gray-700 rounded-lg px-3 py-1.5 text-sm">
                  {Object.entries(COLOR_SYSTEMS).map(([key, sys]) => (
                    <option key={key} value={key}>{sys.name}</option>
                  ))}
                </select>
                <select value={waveform} onChange={(e) => setWaveform(e.target.value)}
                  className="bg-gray-800 border border-gray-700 rounded-lg px-3 py-1.5 text-sm">
                  {WAVEFORMS.map(w => <option key={w} value={w}>{w}</option>)}
                </select>
                <div className="flex items-center gap-1">
                  <span className="text-xs text-gray-500">üîä</span>
                  <input type="range" min="-30" max="0" value={volume} onChange={(e) => setVolume(parseInt(e.target.value))}
                    className="w-16 accent-purple-500" />
                </div>
                <button onClick={() => setShowColors(!showColors)}
                  className={`px-3 py-1.5 rounded-lg text-sm ${showColors ? 'bg-purple-600' : 'bg-gray-700'}`}>
                  {showColors ? 'üé® On' : 'üé® Off'}
                </button>
              </div>
            </div>
          </div>

          <div className="max-w-7xl mx-auto p-4 space-y-4">
            {/* Stats */}
            {mode !== MODES.FREE_PLAY && (
              <div className="bg-gray-900/60 rounded-xl p-4 flex flex-wrap items-center justify-between gap-4">
                <div className="flex gap-6">
                  <div className="text-center">
                    <div className="text-3xl font-bold text-green-400">{stats.correct}</div>
                    <div className="text-xs text-gray-500">Correct</div>
                  </div>
                  <div className="text-center">
                    <div className="text-3xl font-bold text-gray-400">{stats.total}</div>
                    <div className="text-xs text-gray-500">Total</div>
                  </div>
                  <div className="text-center">
                    <div className="text-3xl font-bold text-purple-400">
                      {stats.total > 0 ? Math.round((stats.correct / stats.total) * 100) : 0}%
                    </div>
                    <div className="text-xs text-gray-500">Accuracy</div>
                  </div>
                  <div className="text-center">
                    <div className="text-3xl font-bold text-yellow-400">üî• {stats.streak}</div>
                    <div className="text-xs text-gray-500">Streak</div>
                  </div>
                  <div className="text-center">
                    <div className="text-3xl font-bold text-orange-400">‚≠ê {stats.bestStreak}</div>
                    <div className="text-xs text-gray-500">Best</div>
                  </div>
                </div>
                <button onClick={() => { setStats({ correct: 0, total: 0, streak: 0, bestStreak: 0 }); setSessionHistory([]); }}
                  className="px-4 py-2 bg-gray-800 rounded-lg text-sm hover:bg-gray-700">
                  Reset
                </button>
              </div>
            )}

            {/* Visualization */}
            <div className="h-80 md:h-96 rounded-2xl overflow-hidden border border-gray-800">
              <ImmersiveVisualization
                activeColor={getCurrentColor()}
                intensity={isPlaying ? 1 : 0.3}
                isPlaying={isPlaying}
                particles={particles}
                noteName={currentNote}
              />
            </div>

            {/* Training UI */}
            {mode === MODES.LEARN && trainingNote && (
              <div className="bg-gray-900/60 rounded-xl p-6 text-center space-y-4">
                <h2 className="text-xl font-bold">Learn This Association</h2>
                <div className="flex items-center justify-center gap-8 flex-wrap">
                  <div>
                    <div className="text-5xl font-black">{trainingNote}{trainingOctave}</div>
                    <div className="text-gray-500 text-sm">Note</div>
                  </div>
                  <div className="text-3xl">‚Üí</div>
                  <div>
                    <div className="w-20 h-20 rounded-full mx-auto" style={{
                      backgroundColor: COLOR_SYSTEMS[colorSystem].colors[trainingNote]?.hex,
                      boxShadow: `0 0 40px ${COLOR_SYSTEMS[colorSystem].colors[trainingNote]?.hex}`
                    }} />
                    <div className="text-gray-500 text-sm mt-2">{COLOR_SYSTEMS[colorSystem].colors[trainingNote]?.name}</div>
                  </div>
                </div>
                <div className="flex justify-center gap-3">
                  <button onClick={() => playNote(trainingNote, trainingOctave)}
                    className="px-6 py-3 bg-purple-600 rounded-lg hover:bg-purple-500">üîä Play Again</button>
                  <button onClick={generateTrainingQuestion}
                    className="px-6 py-3 bg-gray-700 rounded-lg hover:bg-gray-600">Next ‚Üí</button>
                </div>
              </div>
            )}

            {mode === MODES.NOTE_TO_COLOR && trainingNote && (
              <div className="bg-gray-900/60 rounded-xl p-6 text-center space-y-4">
                <h2 className="text-xl font-bold">Which color matches this note?</h2>
                <button onClick={() => playNote(trainingNote, trainingOctave)}
                  className="px-6 py-3 bg-purple-600 rounded-lg hover:bg-purple-500">üîä Play Again</button>
                <div className="grid grid-cols-4 md:grid-cols-6 gap-3 mt-4">
                  {NOTES.map(note => (
                    <button key={note} onClick={() => !showResult && handleGuess(note)} disabled={showResult}
                      className={`p-4 rounded-xl transition-all transform hover:scale-105 ${
                        showResult && note === trainingNote ? 'ring-4 ring-green-400 scale-110' : ''
                      } ${showResult && note === userGuess && note !== trainingNote ? 'ring-4 ring-red-400' : ''}`}
                      style={{
                        backgroundColor: COLOR_SYSTEMS[colorSystem].colors[note]?.hex,
                        boxShadow: `0 4px 15px ${COLOR_SYSTEMS[colorSystem].colors[note]?.hex}40`
                      }}>
                      <span className="text-white font-bold text-shadow">{note}</span>
                    </button>
                  ))}
                </div>
                {showResult && (
                  <div className={`text-2xl font-bold ${userGuess === trainingNote ? 'text-green-400' : 'text-red-400'}`}>
                    {userGuess === trainingNote ? '‚úì Correct!' : `‚úó It was ${trainingNote}`}
                  </div>
                )}
              </div>
            )}

            {mode === MODES.COLOR_TO_NOTE && trainingNote && (
              <div className="bg-gray-900/60 rounded-xl p-6 text-center space-y-4">
                <h2 className="text-xl font-bold">Which note is this color?</h2>
                <div className="w-28 h-28 rounded-full mx-auto" style={{
                  backgroundColor: COLOR_SYSTEMS[colorSystem].colors[trainingNote]?.hex,
                  boxShadow: `0 0 60px ${COLOR_SYSTEMS[colorSystem].colors[trainingNote]?.hex}`
                }} />
                <div className="grid grid-cols-4 md:grid-cols-6 gap-3 mt-4">
                  {NOTES.map(note => (
                    <button key={note} onClick={() => !showResult && handleGuess(note)} disabled={showResult}
                      className={`p-4 bg-gray-800 rounded-xl hover:bg-gray-700 transition-all transform hover:scale-105 font-bold text-lg ${
                        showResult && note === trainingNote ? 'ring-4 ring-green-400 bg-green-900/50' : ''
                      } ${showResult && note === userGuess && note !== trainingNote ? 'ring-4 ring-red-400 bg-red-900/50' : ''}`}>
                      {note}
                    </button>
                  ))}
                </div>
                {showResult && (
                  <div className={`text-2xl font-bold ${userGuess === trainingNote ? 'text-green-400' : 'text-red-400'}`}>
                    {userGuess === trainingNote ? '‚úì Correct!' : `‚úó It was ${trainingNote}`}
                  </div>
                )}
              </div>
            )}

            {/* Color Reference */}
            <div className="bg-gray-900/60 rounded-xl p-4">
              <h3 className="text-lg font-bold mb-3">{COLOR_SYSTEMS[colorSystem].name}</h3>
              <div className="grid grid-cols-6 md:grid-cols-12 gap-2">
                {NOTES.map(note => (
                  <button key={note} onClick={() => playNote(note, 4)}
                    className="aspect-square rounded-lg transition-all hover:scale-110"
                    style={{
                      backgroundColor: COLOR_SYSTEMS[colorSystem].colors[note]?.hex,
                      boxShadow: currentNote === note ? `0 0 20px ${COLOR_SYSTEMS[colorSystem].colors[note]?.hex}` : 'none'
                    }}>
                    <span className="text-xs text-white text-shadow font-bold">{note}</span>
                  </button>
                ))}
              </div>
            </div>

            {/* Piano */}
            <div className="bg-gray-900/60 rounded-xl p-4 overflow-x-auto">
              <PianoKeyboard
                currentNote={currentNote}
                currentOctave={currentOctave}
                playNote={playNote}
                colorSystem={colorSystem}
                showColors={showColors}
              />
            </div>

            {/* History */}
            {sessionHistory.length > 0 && (
              <div className="bg-gray-900/60 rounded-xl p-4">
                <h3 className="text-lg font-bold mb-3">Recent Attempts</h3>
                <div className="flex flex-wrap gap-2">
                  {sessionHistory.slice(-24).map((item, i) => (
                    <span key={i} className={`px-3 py-1 rounded-full text-sm ${
                      item.correct ? 'bg-green-900/60 text-green-300' : 'bg-red-900/60 text-red-300'
                    }`}>
                      {item.note} {item.correct ? '‚úì' : `(${item.guess})`}
                    </span>
                  ))}
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
